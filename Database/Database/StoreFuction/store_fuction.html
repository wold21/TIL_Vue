<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stored fuction</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.1b1cc691.css" as="style"><link rel="preload" href="/assets/js/app.3d4a244f.js" as="script"><link rel="preload" href="/assets/js/2.5a32e135.js" as="script"><link rel="preload" href="/assets/js/3.aebfae9b.js" as="script"><link rel="preload" href="/assets/js/34.d9ef7fa5.js" as="script"><link rel="prefetch" href="/assets/js/10.2cc83b15.js"><link rel="prefetch" href="/assets/js/11.33c10e0d.js"><link rel="prefetch" href="/assets/js/12.f786714f.js"><link rel="prefetch" href="/assets/js/13.9b126dd3.js"><link rel="prefetch" href="/assets/js/14.a7e2c688.js"><link rel="prefetch" href="/assets/js/15.25e2fd6d.js"><link rel="prefetch" href="/assets/js/16.2e656889.js"><link rel="prefetch" href="/assets/js/17.7e3b5de5.js"><link rel="prefetch" href="/assets/js/18.309da85a.js"><link rel="prefetch" href="/assets/js/19.3a3eceec.js"><link rel="prefetch" href="/assets/js/20.18c8ec60.js"><link rel="prefetch" href="/assets/js/21.b24689ab.js"><link rel="prefetch" href="/assets/js/22.9c89ce63.js"><link rel="prefetch" href="/assets/js/23.79301e0f.js"><link rel="prefetch" href="/assets/js/24.3d296499.js"><link rel="prefetch" href="/assets/js/25.619476bf.js"><link rel="prefetch" href="/assets/js/26.61f50732.js"><link rel="prefetch" href="/assets/js/27.1b69d916.js"><link rel="prefetch" href="/assets/js/28.89a735d6.js"><link rel="prefetch" href="/assets/js/29.ccc8a54a.js"><link rel="prefetch" href="/assets/js/30.d49bb387.js"><link rel="prefetch" href="/assets/js/31.a19a50ca.js"><link rel="prefetch" href="/assets/js/32.76335e46.js"><link rel="prefetch" href="/assets/js/33.0ae2bfb5.js"><link rel="prefetch" href="/assets/js/35.debc6a05.js"><link rel="prefetch" href="/assets/js/36.b36a476d.js"><link rel="prefetch" href="/assets/js/37.e73e7c0d.js"><link rel="prefetch" href="/assets/js/38.385ed8d9.js"><link rel="prefetch" href="/assets/js/39.4c01027a.js"><link rel="prefetch" href="/assets/js/4.f8c46463.js"><link rel="prefetch" href="/assets/js/40.c3b57856.js"><link rel="prefetch" href="/assets/js/41.f817b799.js"><link rel="prefetch" href="/assets/js/42.d49708a0.js"><link rel="prefetch" href="/assets/js/43.a8ee7d70.js"><link rel="prefetch" href="/assets/js/44.a1e601a9.js"><link rel="prefetch" href="/assets/js/45.51e3202e.js"><link rel="prefetch" href="/assets/js/46.7bca72a3.js"><link rel="prefetch" href="/assets/js/47.8fa0eb38.js"><link rel="prefetch" href="/assets/js/48.d3350cee.js"><link rel="prefetch" href="/assets/js/49.4f1950c1.js"><link rel="prefetch" href="/assets/js/5.2130f56c.js"><link rel="prefetch" href="/assets/js/50.fec7fb28.js"><link rel="prefetch" href="/assets/js/51.e5fa504c.js"><link rel="prefetch" href="/assets/js/52.4d664b62.js"><link rel="prefetch" href="/assets/js/53.74988712.js"><link rel="prefetch" href="/assets/js/54.e9d80ed6.js"><link rel="prefetch" href="/assets/js/55.164a2e7f.js"><link rel="prefetch" href="/assets/js/56.512d2576.js"><link rel="prefetch" href="/assets/js/57.fb9ac4c5.js"><link rel="prefetch" href="/assets/js/58.35b9518f.js"><link rel="prefetch" href="/assets/js/59.00b99f19.js"><link rel="prefetch" href="/assets/js/6.d38de28a.js"><link rel="prefetch" href="/assets/js/60.38a4b3d7.js"><link rel="prefetch" href="/assets/js/61.a3b39054.js"><link rel="prefetch" href="/assets/js/62.ce8b53be.js"><link rel="prefetch" href="/assets/js/63.326b967f.js"><link rel="prefetch" href="/assets/js/64.b0b43d93.js"><link rel="prefetch" href="/assets/js/65.2dfaee8f.js"><link rel="prefetch" href="/assets/js/66.937c1489.js"><link rel="prefetch" href="/assets/js/67.11f94983.js"><link rel="prefetch" href="/assets/js/68.66691571.js"><link rel="prefetch" href="/assets/js/69.b67bcb71.js"><link rel="prefetch" href="/assets/js/7.dc811ad6.js"><link rel="prefetch" href="/assets/js/70.4bb0d425.js"><link rel="prefetch" href="/assets/js/71.a711bb40.js"><link rel="prefetch" href="/assets/js/72.a00784a6.js"><link rel="prefetch" href="/assets/js/73.7baf6484.js"><link rel="prefetch" href="/assets/js/74.5f614c64.js"><link rel="prefetch" href="/assets/js/75.7adcb2c8.js"><link rel="prefetch" href="/assets/js/76.12fe6f01.js"><link rel="prefetch" href="/assets/js/77.41a3cb45.js"><link rel="prefetch" href="/assets/js/78.3681aa9e.js"><link rel="prefetch" href="/assets/js/79.8bfb4e66.js"><link rel="prefetch" href="/assets/js/8.ce67ea46.js"><link rel="prefetch" href="/assets/js/80.c8caf8e2.js"><link rel="prefetch" href="/assets/js/81.1498914c.js"><link rel="prefetch" href="/assets/js/82.d2ef4e52.js"><link rel="prefetch" href="/assets/js/83.679e6c79.js"><link rel="prefetch" href="/assets/js/84.d8c96402.js"><link rel="prefetch" href="/assets/js/85.00dbb840.js"><link rel="prefetch" href="/assets/js/86.26adffd9.js"><link rel="prefetch" href="/assets/js/9.2f95cc59.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b1cc691.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="stored-fuction"><a href="#stored-fuction" class="header-anchor">#</a> Stored fuction</h1> <h2 id="stored-fuction이란"><a href="#stored-fuction이란" class="header-anchor">#</a> Stored fuction이란?</h2> <ul><li>사용자가 정의한 함수</li> <li>DBMS에 저장되고 사용되는 함수</li> <li>SQL의 select, insert, update, delete statement에서 사용할 수 있다.</li></ul> <h3 id="예제"><a href="#예제" class="header-anchor">#</a> 예제</h3> <h4 id="_1-임직원의-id를-열자리-정수로-핸덤하게-발급하고-싶다-id의-맨-앞자리는-1로-고정이다"><a href="#_1-임직원의-id를-열자리-정수로-핸덤하게-발급하고-싶다-id의-맨-앞자리는-1로-고정이다" class="header-anchor">#</a> 1. 임직원의 ID를 열자리 정수로 핸덤하게 발급하고 싶다. ID의 맨 앞자리는 1로 고정이다.</h4> <h5 id="함수-선언"><a href="#함수-선언" class="header-anchor">#</a> 함수 선언</h5> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">delimiter</span> <span class="token operator">&amp;&amp;</span> <span class="token comment">-- 쿼리 구문 문자 수정</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> id_generator<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">int</span>
<span class="token keyword">NO</span> <span class="token keyword">SQL</span> <span class="token comment">-- MySQL 전용</span>
<span class="token keyword">BEGIN</span> <span class="token comment">-- 함수 구현 시작</span>
    <span class="token keyword">RETURN</span> <span class="token punctuation">(</span><span class="token number">1000000000</span> <span class="token operator">+</span> floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">-- 함수 구현 종료</span>
$$ <span class="token comment">-- 쿼리 종료</span>
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span> <span class="token comment">-- 쿼리 구문 문자 복구</span>
</code></pre></div><blockquote><p>delimiter란?<br>
구분 문자를 칭하는 말로 기본값은 ;인데 쿼리에서 ;은 쿼리가 끝났다는 것을 의미하기 때문에 함수 선언 단계에서 세미콜론을 사용할 일이 생긴다면 위와 같이 delimiter를 $$로 바꿔주고 다시 세미콜론으로 바꿔주면 된다. $$와 같은 문자는 임의로 정할 수 있다.</p></blockquote> <h5 id="함수-사용"><a href="#함수-사용" class="header-anchor">#</a> 함수 사용</h5> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employee 
<span class="token keyword">VALUES</span><span class="token punctuation">(</span>id_generator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'JEHN'</span><span class="token punctuation">,</span> <span class="token string">'1991-08-04'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'PO'</span><span class="token punctuation">,</span> <span class="token number">1000000000</span><span class="token punctuation">,</span> <span class="token number">1005</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-부서의-id를-파라미터로-받으면-해당-부서의-평균-연봉을-알려주는-함수를-작성하자"><a href="#_2-부서의-id를-파라미터로-받으면-해당-부서의-평균-연봉을-알려주는-함수를-작성하자" class="header-anchor">#</a> 2. 부서의 ID를 파라미터로 받으면 해당 부서의 평균 연봉을 알려주는 함수를 작성하자.</h4> <h5 id="함수-선언-2"><a href="#함수-선언-2" class="header-anchor">#</a> 함수 선언</h5> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">delimiter</span> <span class="token operator">&amp;&amp;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dept_avg_salary<span class="token punctuation">(</span>d_id <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">int</span>
<span class="token keyword">READS</span> <span class="token keyword">SQL</span> <span class="token keyword">DATA</span> <span class="token comment">-- MySQL 전용</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> avg_sal <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">-- int타입 변수 선언</span>
    <span class="token keyword">SELECT</span> <span class="token function">avg</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token comment">-- 조회된 데이터를 avg_sal에 대입</span>
                        <span class="token keyword">FROM</span> employee
                        <span class="token keyword">WHERE</span> dept_id <span class="token operator">=</span> d_id<span class="token punctuation">;</span>
    <span class="token keyword">RETURN</span> avg_sal<span class="token punctuation">;</span> <span class="token comment">-- 값 리턴</span>
<span class="token keyword">END</span>
$$

<span class="token comment">-- 또는 변수를 선언하지 않고 바로 쓰고 싶다면</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dept_avg_salary<span class="token punctuation">(</span>d_id <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">int</span>
<span class="token keyword">READS</span> <span class="token keyword">SQL</span> <span class="token keyword">DATA</span> <span class="token comment">-- MySQL 전용</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SELECT</span> <span class="token function">avg</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> <span class="token variable">@avg_sal</span>
                        <span class="token keyword">FROM</span> employee
                        <span class="token keyword">WHERE</span> dept_id <span class="token operator">=</span> d_id<span class="token punctuation">;</span>
    <span class="token keyword">RETURN</span> <span class="token variable">@avg_sal</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
$$
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre></div><h5 id="함수-사용-2"><a href="#함수-사용-2" class="header-anchor">#</a> 함수 사용</h5> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> dept_avg_salary<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_salary
<span class="token keyword">FROM</span> department<span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-졸업-요건-중-하나인-토익-800-이상을-충족했는지를-알려주는-함수를-작성하자"><a href="#_3-졸업-요건-중-하나인-토익-800-이상을-충족했는지를-알려주는-함수를-작성하자" class="header-anchor">#</a> 3. 졸업 요건 중 하나인 토익 800 이상을 충족했는지를 알려주는 함수를 작성하자.</h4> <h5 id="함수-선언-3"><a href="#함수-선언-3" class="header-anchor">#</a> 함수 선언</h5> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">delimiter</span> <span class="token operator">&amp;&amp;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> toeic_pass_fail<span class="token punctuation">(</span>toeic_score <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">NO</span> <span class="token keyword">SQL</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> pass_fail <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">IF</span> toeic_score <span class="token operator">is</span> <span class="token boolean">null</span>   <span class="token keyword">THEN</span> <span class="token keyword">SET</span> pass_fail <span class="token operator">=</span> <span class="token string">'fail'</span><span class="token punctuation">;</span>
    <span class="token keyword">ELSEIF</span> toeic_score <span class="token operator">&lt;</span> <span class="token number">800</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> pass_fail <span class="token operator">=</span> <span class="token string">'fail'</span><span class="token punctuation">;</span>
    <span class="token keyword">ELSE</span>                     <span class="token keyword">THEN</span> <span class="token keyword">SET</span> pass_fail <span class="token operator">=</span> <span class="token string">'pass'</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
    <span class="token keyword">RETURN</span> pass_fail
<span class="token keyword">END</span>
$$
<span class="token comment">-- 또는</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> toeic_pass_fail<span class="token punctuation">(</span>toeic_score <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">NO</span> <span class="token keyword">SQL</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">IF</span> toeic_score <span class="token operator">is</span> <span class="token boolean">null</span>   <span class="token keyword">THEN</span> <span class="token keyword">SET</span> <span class="token variable">@pass_fail</span> <span class="token operator">=</span> <span class="token string">'fail'</span><span class="token punctuation">;</span>
    <span class="token keyword">ELSEIF</span> toeic_score <span class="token operator">&lt;</span> <span class="token number">800</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> <span class="token variable">@pass_fail</span> <span class="token operator">=</span> <span class="token string">'fail'</span><span class="token punctuation">;</span>
    <span class="token keyword">ELSE</span>                     <span class="token keyword">THEN</span> <span class="token keyword">SET</span> <span class="token variable">@pass_fail</span> <span class="token operator">=</span> <span class="token string">'pass'</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
    <span class="token keyword">RETURN</span> <span class="token variable">@pass_fail</span>
<span class="token keyword">END</span>
$$
<span class="token keyword">delimiter</span> <span class="token punctuation">;</span>
</code></pre></div><h5 id="함수-사용-3"><a href="#함수-사용-3" class="header-anchor">#</a> 함수 사용</h5> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> toeic_pass_fail<span class="token punctuation">(</span>toeic<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
</code></pre></div><h3 id="stored-fuction-정리"><a href="#stored-fuction-정리" class="header-anchor">#</a> Stored fuction 정리</h3> <ul><li>이외에도 loop를 돌면서 반복적인 작업을 수행하거나</li> <li>case 키워드를 사용해서 값에 따라 분기 처리하거나</li> <li>에러를 핸들링하거나 에러를 일으키는 등의 다양한 동작을 정의할 수 있다</li></ul> <h4 id="stored-fuction-삭제하기"><a href="#stored-fuction-삭제하기" class="header-anchor">#</a> Stored fuction 삭제하기</h4> <div class="language-SQL extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> stored_function_name<span class="token punctuation">;</span>
</code></pre></div><h4 id="등록된-stored-fuction-파악하기"><a href="#등록된-stored-fuction-파악하기" class="header-anchor">#</a> 등록된 Stored fuction 파악하기</h4> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># DBMS shell에서...</span>

<span class="token comment"># DB 조회</span>
SHOW DATABASES<span class="token punctuation">;</span>

<span class="token comment"># DB의 함수 조회</span>
SHOW FUNCTION STATUS where DB <span class="token operator">=</span> <span class="token string">'company'</span><span class="token punctuation">;</span>

<span class="token comment"># 함수의 코드 조회</span>
SHOW CREATE FUNCTION id_generator<span class="token punctuation">;</span>
</code></pre></div><h2 id="마무리-stored-fuction은-언제-써야할까"><a href="#마무리-stored-fuction은-언제-써야할까" class="header-anchor">#</a> 마무리 &amp; Stored fuction은 언제 써야할까?</h2> <h3 id="three-tier-architecture"><a href="#three-tier-architecture" class="header-anchor">#</a> Three-tier architecture</h3> <br> <img src="/assets/img/three-tier.4212f085.png" alt="three-tier" height="300"> <p>이번 부분을 공부하면서 개발자를 하고 있는 다른 형에게 질문을 했다. 왜냐하면 예전에 그 형이 &quot;내가 지금하고 있는 프로젝트는 웬만한걸 다 DB에서 처리를 해.&quot;라고 했던 기억이 났기 때문이다. 물어본 질문은 &quot;형 프로젝트 할 때 함수나 프로시져를 많이 써?&quot;라는 질문이었다. 돌아온 질문은 엄청 많이 썼다고 했고 PL/SQL만 알면 크게 어렵지 않다라고 했다. 하지만 문득 이번 내용을 공부하면서 계속 관리하기가 힘들텐데...라는 생각이 멈추지 않았다. 새로 들어온 직원분이나 선임에게 전달받을 때를 생각하니 벌써부터 지쳐가는 모습이 보였기 때문이다. 물론 DB tool을 쓰고 그러면 전달은 어렵지 않겠지만 수많은 사람들이 작업하는 코드인 만큼 버려지는 함수들도 많을 것 같았고 혹시라도 연산에 부하가 걸리는 작업이라면 DB 메모리에 영향을 미치지는 않을까? 하는 걱정도 들었기 떄문이다. 마지막에 쉬운코딩님이 정리한 &quot;Stored fuction은 언제 써야할까?&quot;에 대한 내용은 다음과 같다. 우리 대부분의 IT 회사는 위에 보여지는 그림처럼 three-tier architecture를 따르고 있기 때문에 비즈니스 로직이거나 비슷한 로직은 비즈니스 로직에 위치해 있어야 관리도 쉽고 파악도 쉽다고 생각하기 때문에 util용도로 쓰는 함수는 괜찮지만 그 외의 함수는 비즈니스 단에서 처리하는게 맞는 것 같다라고 이야기를 해주셨다. 내가 걱정했던 부분과 상통하는 부분이 있어서 괜시리 기분이 좋아졌다. 이 다음 글은 프로시져에 관한 글인데 이것 또한 기대가 되는 부분이다.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3d4a244f.js" defer></script><script src="/assets/js/2.5a32e135.js" defer></script><script src="/assets/js/3.aebfae9b.js" defer></script><script src="/assets/js/34.d9ef7fa5.js" defer></script>
  </body>
</html>
